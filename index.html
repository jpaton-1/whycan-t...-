<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple AR Test</title>
    
    <!-- A-Frame and AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
        .arjs-loader {
            position: fixed;
            z-index: 999;
            overflow: show;
            margin: auto;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .arjs-loader div {
            text-align: center;
            color: white;
            max-width: 80%;
            font-family: Arial, Helvetica, sans-serif;
        }
        
        #camera-error {
            position: fixed;
            z-index: 1000;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 0, 0, 0.7);
            color: white;
            text-align: center;
            padding: 10px 0;
            display: none;
        }
        
        #debug-panel {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            z-index: 1000;
            width: 200px;
            height: 100px;
            overflow: auto;
        }
    </style>
</head>
<body style="margin: 0; overflow: hidden;">
    <!-- Camera Error Message -->
    <div id="camera-error">
        <p>Camera access error. Please check browser permissions.</p>
    </div>
    
    <!-- Debug Panel -->
    <div id="debug-panel">
        <div id="debug-content">Debug info will appear here</div>
    </div>
    
    <div class="arjs-loader">
        <div>
            <h1>Simple AR Test</h1>
            <p>Loading... Please allow camera access when prompted.</p>
        </div>
    </div>
    
    <!-- AR Scene -->
    <a-scene 
        vr-mode-ui="enabled: false"
        embedded
        arjs='sourceType: webcam; debugUIEnabled: true; detectionMode: mono_and_matrix;'
        renderer="logarithmicDepthBuffer: true;"
        loading-screen="enabled: false">
        
        <!-- Basic 3D Test Objects -->
        <a-box position="0 0.5 -3" rotation="0 45 0" color="#4CC3D9" shadow></a-box>
        <a-sphere position="-1 0.5 -3" radius="0.5" color="#EF2D5E" shadow></a-sphere>
        <a-cylinder position="1 0.75 -3" radius="0.5" height="1.5" color="#FFC65D" shadow></a-cylinder>
        <a-plane position="0 0 -3" rotation="-90 0 0" width="4" height="4" color="#7BC8A4" shadow></a-plane>
        
        <!-- Camera -->
        <a-entity camera></a-entity>
    </a-scene>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const debugPanel = document.getElementById('debug-content');
            const arjsLoader = document.querySelector('.arjs-loader');
            const cameraErrorDiv = document.getElementById('camera-error');
            
            // Add debug message
            function debug(message) {
                console.log(message);
                if (debugPanel) {
                    debugPanel.innerHTML += message + '<br>';
                }
            }
            
            debug('Page loaded. Checking camera...');
            
            // Show camera error
            function showCameraError(message) {
                debug('Camera error: ' + message);
                if (cameraErrorDiv) {
                    cameraErrorDiv.textContent = 'Camera error: ' + message;
                    cameraErrorDiv.style.display = 'block';
                }
                arjsLoader.style.display = 'none';
            }
            
            // Try to get camera access
            function requestCameraAccess() {
                debug('Requesting camera...');
                
                navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment',
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    }, 
                    audio: false 
                })
                .then(function(stream) {
                    debug('Camera access granted');
                    
                    // Show camera stream dimensions
                    const videoTracks = stream.getVideoTracks();
                    if (videoTracks.length > 0) {
                        const settings = videoTracks[0].getSettings();
                        debug(`Camera: ${settings.width}x${settings.height}`);
                    }
                    
                    // We need to stop this stream since AR.js will create its own
                    stream.getTracks().forEach(track => track.stop());
                    
                    // Hide loader after delay
                    setTimeout(() => {
                        arjsLoader.style.display = 'none';
                    }, 3000);
                })
                .catch(function(error) {
                    showCameraError(error.name + ': ' + error.message);
                });
            }
            
            // Check browser compatibility
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                showCameraError('Your browser does not support WebRTC camera access');
            } else {
                requestCameraAccess();
            }
            
            // Listen for AR.js camera-init event
            const scene = document.querySelector('a-scene');
            if (scene) {
                scene.addEventListener('camera-init', function() {
                    debug('AR.js camera initialized');
                });
                
                scene.addEventListener('camera-error', function(ev) {
                    debug('AR.js camera error: ' + ev.detail.message);
                    showCameraError(ev.detail.message);
                });
            }
        });
    </script>
</body>
</html>