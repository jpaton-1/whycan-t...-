<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Garden AR</title>
    
    <!-- A-Frame and AR.js -->
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    
    <style>
        .arjs-loader {
            position: fixed;
            z-index: 999;
            overflow: show;
            margin: auto;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .arjs-loader div {
            text-align: center;
            color: white;
            max-width: 80%;
            font-family: Arial, Helvetica, sans-serif;
        }
    </style>
    
    <script>
        // Flower model placer component
        AFRAME.registerComponent('flower-garden', {
            schema: {
                flowerCount: {type: 'number', default: 15},
                radius: {type: 'number', default: 3}
            },
            
            init: function() {
                this.placeFlowers();
            },
            
            placeFlowers: function() {
                // Local flower model files from repository
                const flowerModels = [
                    '6 Orchid.glb',
                    '7 Poppy.glb',
                    '8 Iris.glb',
                    '13 Marigold.glb',
                    '16 Lavender.glb',
                    '17 Hibiscus.glb',
                    '20 Violet.glb',
                    '24 Cosmos.glb',
                    '25 Snapdragon.glb',
                    '26 Morning Glory.glb',
                    '27 Anemone.glb',
                    '30 Primrose.glb'
                ];
                
                // Place flowers in a circular pattern on the ground
                for (let i = 0; i < this.data.flowerCount; i++) {
                    // Calculate position in a circle with some randomness
                    const angle = (i / this.data.flowerCount) * Math.PI * 2;
                    const randomRadius = this.data.radius * (0.3 + Math.random() * 0.7);
                    const x = Math.cos(angle) * randomRadius;
                    const z = Math.sin(angle) * randomRadius;
                    
                    // Randomize model selection
                    const modelIndex = Math.floor(Math.random() * flowerModels.length);
                    const modelUrl = flowerModels[modelIndex];
                    
                    // Create flower entity
                    const flower = document.createElement('a-entity');
                    flower.setAttribute('gltf-model', modelUrl);
                    
                    // Position flower on ground level with slight variation
                    flower.setAttribute('position', {x: x, y: -2.0, z: z});
                    
                    // Random scale, but keep it proportional
                    const scale = 0.5 + Math.random() * 0.3;
                    flower.setAttribute('scale', {
                        x: scale,
                        y: scale,
                        z: scale
                    });
                    
                    flower.setAttribute('rotation', {
                        x: 0, 
                        y: Math.random() * 360, 
                        z: 0
                    });
                    
                    // Add spring-up animation
                    flower.setAttribute('animation', {
                        property: 'position',
                        from: `${x} -2.2 ${z}`,
                        to: `${x} -2.0 ${z}`,
                        dur: 3000 + Math.random() * 2000,
                        delay: Math.random() * 3000,
                        easing: 'easeOutElastic',
                        loop: false
                    });
                    
                    this.el.appendChild(flower);
                }
            }
        });
    </script>
</head>
<body style="margin: 0; overflow: hidden;">
    <div class="arjs-loader">
        <div>
            <h1>Garden AR</h1>
            <p>Loading... Please allow camera access when prompted.</p>
        </div>
    </div>
    
    <a-scene 
        vr-mode-ui="enabled: false"
        embedded
        arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix;"
        renderer="logarithmicDepthBuffer: true;">
        
        <!-- Simple Text (No 3D extrusion or fancy fonts) -->
        <a-text 
            value="Why can't this be a community garden?"
            color="white" 
            align="center"
            width="4"
            position="0 0.5 -4"
            scale="1 1 1">
        </a-text>
        
        <!-- 3D Flower Garden -->
        <a-entity 
            position="0 0 -4"
            flower-garden="flowerCount: 15; radius: 3">
        </a-entity>
        
        <!-- Camera -->
        <a-entity camera></a-entity>
    </a-scene>
    
    <script>
        // Simple loader handling
        document.addEventListener('DOMContentLoaded', function() {
            const arjsLoader = document.querySelector('.arjs-loader');
            
            // Hide loader after a set time
            setTimeout(() => {
                if (arjsLoader) {
                    arjsLoader.style.display = 'none';
                }
            }, 3000);
            
            // Also listen for scene loaded event as backup
            const scene = document.querySelector('a-scene');
            if (scene) {
                scene.addEventListener('loaded', function() {
                    console.log('Scene loaded');
                    if (arjsLoader) {
                        arjsLoader.style.display = 'none';
                    }
                });
            }
        });
    </script>
</body>
</html>